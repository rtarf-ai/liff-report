<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£ v4.1</title>

  <!-- Tailwind CSS v3.4 -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.4.4/dist/tailwind.min.css" rel="stylesheet">

  <!-- Google Fonts: Sarabun -->
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <!-- LINE LIFF SDK -->
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

  <style>
    body {
      font-family: 'Sarabun', sans-serif;
      background: linear-gradient(135deg, #0f0f1e 0%, #1a1a2e 100%);
      min-height: 100vh;
      margin: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #e0e0ff;
    }
    .glass-card {
      background: rgba(255, 255, 255, 0.08);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-radius: 24px;
      border: 1px solid rgba(255, 255, 255, 0.12);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
      padding: 2rem;
      width: 100%;
      max-width: 420px;
      transition: all 0.4s ease;
    }
    .glass-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 30px 60px rgba(0, 0, 0, 0.5);
    }
    .loading-overlay {
      position: fixed;
      inset: 0;
      background: rgba(15, 15, 30, 0.98);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      transition: opacity 0.8s ease;
    }
    .btn-gradient {
      background: linear-gradient(90deg, #6366f1, #8b5cf6);
      transition: all 0.3s ease;
    }
    .btn-gradient:hover {
      background: linear-gradient(90deg, #4f46e5, #7c3aed);
      transform: translateY(-2px);
    }
    .input-focus:focus {
      outline: none;
      ring: 2px solid #818cf8;
      border-color: #818cf8;
    }
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .animate-fade-in-up {
      animation: fadeInUp 0.8s ease-out forwards;
    }
  </style>
</head>
<body>

  <!-- Loading Screen -->
  <div id="loading-screen" class="loading-overlay">
    <div class="relative">
      <div class="animate-spin rounded-full h-20 w-20 border-t-4 border-indigo-400 border-opacity-50"></div>
      <div class="absolute inset-0 flex items-center justify-center">
        <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
        </svg>
      </div>
    </div>
    <p id="loading-text" class="mt-8 text-white text-xl font-medium tracking-wide">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ LINE...</p>
    <button id="retry-btn" onclick="initLiff()" class="mt-6 px-8 py-3 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl shadow-lg hidden transition">
      ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà
    </button>
  </div>

  <!-- Main Content -->
  <div id="main-content" class="glass-card hidden">
    <div class="text-center mb-10">
      <div class="inline-block bg-gradient-to-br from-indigo-600 to-purple-700 p-5 rounded-2xl shadow-2xl mb-6 transform hover:scale-105 transition">
        <svg class="w-14 h-14 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
        </svg>
      </div>
      <h1 class="text-3xl font-bold text-white mb-2">‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£</h1>
      <p id="thai-date" class="text-indigo-300 font-medium text-lg">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà...</p>
    </div>

    <form onsubmit="event.preventDefault();" class="space-y-6">
      <!-- Reporter -->
      <div class="animate-fade-in-up" style="animation-delay: 0.1s;">
        <label class="block text-sm font-semibold text-gray-300 uppercase tracking-wider mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</label>
        <select id="reporter" class="w-full px-5 py-4 bg-gray-800/40 border border-gray-600 rounded-xl text-white text-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none input-focus transition">
          <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠</option>
          <option>‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡∏™‡∏≤‡∏¢‡∏•‡∏∏‡∏¢</option>
          <option>‡∏™‡∏°‡∏´‡∏ç‡∏¥‡∏á ‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏à</option>
          <option>‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢ ‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠</option>
          <option>‡∏ß‡∏¥‡∏ä‡∏±‡∏¢ ‡∏°‡∏µ‡∏™‡∏∏‡∏Ç</option>
          <option>‡πÄ‡∏Å‡∏£‡∏µ‡∏¢‡∏á‡πÑ‡∏Å‡∏£ ‡πÉ‡∏à‡∏î‡∏µ</option>
        </select>
      </div>

      <!-- News Grid -->
      <div class="grid grid-cols-2 gap-5 animate-fade-in-up" style="animation-delay: 0.2s;">
        <div class="bg-blue-900/20 p-6 rounded-2xl border border-blue-500/30 backdrop-blur-md shadow-inner">
          <label class="block text-sm font-semibold text-blue-300 uppercase mb-3">üì• ‡∏Ç‡πà‡∏≤‡∏ß‡∏£‡∏±‡∏ö</label>
          <input type="number" id="inNews" value="0" min="0" oninput="calcTotal()" 
                 class="w-full bg-transparent text-4xl font-black text-blue-100 outline-none text-center">
        </div>
        <div class="bg-red-900/20 p-6 rounded-2xl border border-red-500/30 backdrop-blur-md shadow-inner">
          <label class="block text-sm font-semibold text-red-300 uppercase mb-3">üì§ ‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡πà‡∏á</label>
          <input type="number" id="outNews" value="0" min="0" oninput="calcTotal()" 
                 class="w-full bg-transparent text-4xl font-black text-red-100 outline-none text-center">
        </div>
      </div>

      <!-- Total -->
      <div class="bg-gradient-to-r from-gray-900/70 to-indigo-900/50 p-7 rounded-2xl shadow-inner relative overflow-hidden animate-fade-in-up" style="animation-delay: 0.3s;">
        <div class="relative z-10 flex justify-between items-center">
          <span class="text-gray-300 font-semibold text-lg">‡∏£‡∏ß‡∏°‡∏¢‡∏≠‡∏î‡∏Ç‡πà‡∏≤‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô</span>
          <span id="totalNews" class="text-5xl font-black text-white">0</span>
        </div>
        <div class="absolute inset-0 bg-indigo-600 opacity-5 blur-3xl"></div>
      </div>

      <!-- Submit Button -->
      <button type="button" id="submitBtn" onclick="sendReport()"
              class="w-full btn-gradient text-white font-bold text-lg py-5 rounded-2xl shadow-2xl flex items-center justify-center space-x-3 transform hover:scale-105 transition-all animate-fade-in-up" style="animation-delay: 0.4s;">
        <span>‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏° LINE ‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</span>
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
        </svg>
      </button>
    </form>
  </div>

  <script>
    // === ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏î‡πâ‡∏ß‡∏¢ LIFF ID ‡∏à‡∏£‡∏¥‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ===
    const LIFF_ID = "2008762104-jCr3Y4cc";

    // === URL ‡∏Ç‡∏≠‡∏á GAS Backend (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•) ===
    const GAS_BACKEND_URL = "https://script.google.com/macros/s/AKfycbzgmNBzuPs6H1ExLeW_Q2t3cPWpsqH5m5uYaLj_jfSWNtE06fWeIVqw-T96xn1-IWc/exec";

    async function initLiff() {
      const loadingText = document.getElementById('loading-text');
      const retryBtn = document.getElementById('retry-btn');
      loadingText.innerText = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö...';
      retryBtn.classList.add('hidden');

      try {
        if (!LIFF_ID || LIFF_ID === "YOUR_LIFF_ID_HERE") {
          throw new Error("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà LIFF ID ‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏ô‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ LIFF_ID");
        }

        await liff.init({ liffId: LIFF_ID });

        if (!liff.isLoggedIn()) {
          liff.login({ redirectUri: window.location.href });
          return;
        }

        if (!liff.isApiAvailable('shareTargetPicker')) {
          throw new Error("Share Target Picker ‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô");
        }

        // ‡∏î‡∏∂‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏ó‡∏¢‡∏à‡∏≤‡∏Å backend
        const res = await fetch(`${GAS_BACKEND_URL}?action=getDate`);
        const { date } = await res.json();
        document.getElementById('thai-date').innerText = date;

        // ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏´‡∏•‡∏±‡∏Å
        document.getElementById('loading-screen').style.opacity = '0';
        setTimeout(() => {
          document.getElementById('loading-screen').classList.add('hidden');
          document.getElementById('main-content').classList.remove('hidden');
        }, 800);

      } catch (err) {
        console.error(err);
        loadingText.innerText = '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î';
        retryBtn.classList.remove('hidden');
        Swal.fire('‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', err.message, 'error');
      }
    }

    function calcTotal() {
      const inVal = parseInt(document.getElementById('inNews').value) || 0;
      const outVal = parseInt(document.getElementById('outNews').value) || 0;
      document.getElementById('totalNews').innerText = (inVal + outVal).toLocaleString('th-TH');
    }

    async function sendReport() {
      const reporter = document.getElementById('reporter').value.trim();
      const inNews = parseInt(document.getElementById('inNews').value) || 0;
      const outNews = parseInt(document.getElementById('outNews').value) || 0;
      const total = inNews + outNews;
      const dateStr = document.getElementById('thai-date').innerText;

      if (!reporter) return Swal.fire('‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô', 'warning');
      if (total === 0) return Swal.fire('‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏¢‡∏≠‡∏î‡∏Ç‡πà‡∏≤‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£', 'warning');

      const btn = document.getElementById('submitBtn');
      const originalHTML = btn.innerHTML;
      btn.disabled = true;
      btn.innerHTML = '<span class="animate-pulse">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á...</span>';

      const flexMessage = {
        type: "bubble",
        size: "mega",
        header: {
          type: "box",
          layout: "vertical",
          paddingAll: "20px",
          backgroundColor: "#4f46e5",
          contents: [
            { type: "text", text: "üìä ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£", weight: "bold", size: "xl", color: "#ffffff" },
            { type: "text", text: dateStr, size: "sm", color: "#ffffffcc", margin: "md" }
          ]
        },
        body: {
          type: "box",
          layout: "vertical",
          paddingAll: "25px",
          contents: [
            { type: "box", layout: "horizontal", contents: [
              { type: "text", text: "üì• ‡∏Ç‡πà‡∏≤‡∏ß‡∏£‡∏±‡∏ö", color: "#cccccc", flex: 4 },
              { type: "text", text: inNews.toLocaleString() + " ‡∏Ç‡πà‡∏≤‡∏ß", weight: "bold", color: "#60a5fa", align: "end" }
            ]},
            { type: "box", layout: "horizontal", margin: "lg", contents: [
              { type: "text", text: "üì§ ‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡πà‡∏á", color: "#cccccc", flex: 4 },
              { type: "text", text: outNews.toLocaleString() + " ‡∏Ç‡πà‡∏≤‡∏ß", weight: "bold", color: "#f87171", align: "end" }
            ]},
            { type: "separator", margin: "xl" },
            { type: "box", layout: "horizontal", margin: "xl", contents: [
              { type: "text", text: "‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î", weight: "bold", size: "lg" },
              { type: "text", text: total.toLocaleString() + " ‡∏Ç‡πà‡∏≤‡∏ß", weight: "bold", size: "xl", color: "#a78bfa", align: "end" }
            ]}
          ]
        },
        footer: {
          type: "box",
          layout: "vertical",
          contents: [
            { type: "text", text: "‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÇ‡∏î‡∏¢: " + reporter, color: "#999999", size: "sm", align: "center" }
          ]
        },
        styles: { footer: { separator: true } }
      };

      try {
        // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        await fetch(GAS_BACKEND_URL, {
          method: 'POST',
          body: JSON.stringify({ action: 'save', reporter, inNews, outNews, total, dateStr }),
          headers: { 'Content-Type': 'application/json' }
        });

        // ‡∏™‡πà‡∏á Flex Message
        const result = await liff.shareTargetPicker([{
          type: "flex",
          altText: "‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏¢‡∏≠‡∏î‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô",
          contents: flexMessage
        }]);

        if (result) {
          Swal.fire({ icon: 'success', title: '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', text: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', timer: 2000 });
        } else {
          Swal.fire('‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å', '‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢', 'info');
        }
      } catch (err) {
        Swal.fire('‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', err.message, 'error');
      } finally {
        btn.disabled = false;
        btn.innerHTML = originalHTML;
      }
    }

    window.onload = initLiff;
  </script>
</body>
</html>
