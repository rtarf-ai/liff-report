<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£ v4.0</title>
  
  <!-- Tailwind CSS v3.4 (Production Minified) -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.4.4/dist/tailwind.min.css" rel="stylesheet">
  
  <!-- Google Fonts: Sarabun -->
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;700&display=swap" rel="stylesheet">
  
  <!-- SweetAlert2 & LINE LIFF SDK -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  
  <style>
    body { 
      font-family: 'Sarabun', sans-serif;
      background: linear-gradient(135deg, #1e1e2f 0%, #2d3436 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1rem;
    }
    .glass-card {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-radius: 1.5rem;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.37);
      border: 1px solid rgba(255, 255, 255, 0.18);
      width: 100%;
      max-width: 28rem;
      transition: all 0.3s ease;
    }
    .glass-card:hover { 
      transform: translateY(-4px); 
      box-shadow: 0 16px 48px rgba(0, 0, 0, 0.5); 
    }
    .loading-overlay {
      position: fixed; inset: 0;
      background: rgba(30, 30, 47, 0.98);
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      z-index: 9999;
      transition: opacity 0.6s ease;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .animate-fade-in { animation: fadeIn 0.6s ease-out forwards; }
  </style>
</head>
<body>

  <!-- Loading Screen -->
  <div id="loading-screen" class="loading-overlay">
    <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-indigo-400 mb-6"></div>
    <p id="loading-text" class="text-white text-xl font-light tracking-wider animate-pulse">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ LINE...</p>
    <button id="retry-btn" onclick="initLiff()" class="mt-6 px-8 py-3 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl shadow-lg hidden transition">
      ‡∏•‡∏≠‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÉ‡∏´‡∏°‡πà
    </button>
  </div>

  <!-- Main Form -->
  <div id="main-content" class="glass-card p-6 md:p-8 hidden">
    <div class="text-center mb-8 animate-fade-in" style="animation-delay: 0.1s;">
      <div class="w-20 h-20 bg-indigo-600 rounded-2xl mx-auto mb-5 flex items-center justify-center shadow-2xl">
        <svg class="w-12 h-12 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
        </svg>
      </div>
      <h1 class="text-3xl font-bold text-white">‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£</h1>
      <p id="thai-date" class="text-indigo-300 font-medium mt-2">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà...</p>
    </div>

    <form onsubmit="event.preventDefault();" class="space-y-6">
      <div class="animate-fade-in" style="animation-delay: 0.2s;">
        <label class="block text-sm font-bold text-gray-300 uppercase tracking-wider mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</label>
        <select id="reporter" class="w-full p-4 bg-gray-800/60 border border-gray-600 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none text-white transition">
          <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</option>
          <option>‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡∏™‡∏≤‡∏¢‡∏•‡∏∏‡∏¢</option>
          <option>‡∏™‡∏°‡∏´‡∏ç‡∏¥‡∏á ‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏à</option>
          <option>‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢ ‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠</option>
          <option>‡∏ß‡∏¥‡∏ä‡∏±‡∏¢ ‡∏°‡∏µ‡∏™‡∏∏‡∏Ç</option>
          <option>‡πÄ‡∏Å‡∏£‡∏µ‡∏¢‡∏á‡πÑ‡∏Å‡∏£ ‡πÉ‡∏à‡∏î‡∏µ</option>
        </select>
      </div>

      <div class="grid grid-cols-2 gap-5 animate-fade-in" style="animation-delay: 0.3s;">
        <div class="bg-blue-900/30 p-5 rounded-xl border border-blue-500/30 backdrop-blur">
          <label class="block text-sm font-bold text-blue-300 uppercase mb-3">üì• ‡∏Ç‡πà‡∏≤‡∏ß‡∏£‡∏±‡∏ö</label>
          <input type="number" id="inNews" value="0" min="0" oninput="calcTotal()" 
                 class="w-full bg-transparent text-3xl font-black text-blue-100 outline-none">
        </div>
        <div class="bg-red-900/30 p-5 rounded-xl border border-red-500/30 backdrop-blur">
          <label class="block text-sm font-bold text-red-300 uppercase mb-3">üì§ ‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡πà‡∏á</label>
          <input type="number" id="outNews" value="0" min="0" oninput="calcTotal()" 
                 class="w-full bg-transparent text-3xl font-black text-red-100 outline-none">
        </div>
      </div>

      <div class="bg-gradient-to-r from-gray-900 to-indigo-900/60 p-7 rounded-xl shadow-2xl relative overflow-hidden animate-fade-in" style="animation-delay: 0.4s;">
        <div class="relative z-10 flex justify-between items-center">
          <span class="text-gray-300 font-semibold text-lg">‡∏£‡∏ß‡∏°‡∏¢‡∏≠‡∏î‡∏Ç‡πà‡∏≤‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô</span>
          <span id="totalNews" class="text-4xl font-black text-white">0</span>
        </div>
        <div class="absolute inset-0 bg-indigo-600 opacity-5 blur-3xl"></div>
      </div>

      <button type="button" onclick="sendReport()" id="submitBtn"
              class="w-full bg-gradient-to-r from-indigo-600 to-purple-700 hover:from-indigo-700 hover:to-purple-800 text-white font-bold text-lg py-5 rounded-xl shadow-2xl flex items-center justify-center space-x-3 transform hover:scale-105 transition-all animate-fade-in" 
              style="animation-delay: 0.5s;">
        <span>‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏•‡∏∏‡πà‡∏° LINE ‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span>
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
        </svg>
      </button>
    </form>
  </div>

  <script>
    // === ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏î‡πâ‡∏ß‡∏¢ LIFF ID ‡∏à‡∏£‡∏¥‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ===
    const LIFF_ID = "2008762104-jCr3Y4cc"; // ‡πÄ‡∏ä‡πà‡∏ô "1651234567-AbCdEfGh"

    // === URL ‡∏Ç‡∏≠‡∏á Google Apps Script Backend (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•) ===
    const GAS_BACKEND_URL = "https://script.google.com/macros/s/AKfycbzgmNBzuPs6H1ExLeW_Q2t3cPWpsqH5m5uYaLj_jfSWNtE06fWeIVqw-T96xn1-IWc/exec";

    async function initLiff() {
      const loadingText = document.getElementById('loading-text');
      const retryBtn = document.getElementById('retry-btn');
      loadingText.innerText = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö...';
      retryBtn.classList.add('hidden');

      try {
        if (!LIFF_ID || LIFF_ID === "YOUR_LIFF_ID_HERE") {
          throw new Error("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà LIFF ID ‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏ô‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ LIFF_ID");
        }

        await liff.init({ liffId: LIFF_ID });
        loadingText.innerText = '‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô...';

        if (!liff.isLoggedIn()) {
          liff.login({ redirectUri: window.location.href });
          return;
        }

        if (!liff.isApiAvailable('shareTargetPicker')) {
          throw new Error("Share Target Picker ‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ô LINE Developers Console ‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï LINE App");
        }

        // ‡πÇ‡∏´‡∏•‡∏î‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏ó‡∏¢‡∏à‡∏≤‡∏Å backend
        const dateRes = await fetch(GAS_BACKEND_URL + '?action=getDate');
        const { date } = await dateRes.json();
        document.getElementById('thai-date').innerText = date;

        // ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
        document.getElementById('loading-screen').style.opacity = '0';
        setTimeout(() => {
          document.getElementById('loading-screen').classList.add('hidden');
          document.getElementById('main-content').classList.remove('hidden');
        }, 600);

      } catch (error) {
        console.error(error);
        loadingText.innerText = '‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß';
        retryBtn.classList.remove('hidden');
        Swal.fire('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ LINE', error.message, 'error');
      }
    }

    function calcTotal() {
      const inVal = parseInt(document.getElementById('inNews').value) || 0;
      const outVal = parseInt(document.getElementById('outNews').value) || 0;
      document.getElementById('totalNews').innerText = (inVal + outVal).toLocaleString('th-TH');
    }

    async function sendReport() {
      const reporter = document.getElementById('reporter').value.trim();
      const inNews = parseInt(document.getElementById('inNews').value) || 0;
      const outNews = parseInt(document.getElementById('outNews').value) || 0;
      const total = inNews + outNews;
      const dateStr = document.getElementById('thai-date').innerText;

      if (!reporter) return Swal.fire('‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô', 'warning');
      if (total === 0) return Swal.fire('‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏¢‡∏≠‡∏î‡∏Ç‡πà‡∏≤‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£', 'warning');

      const btn = document.getElementById('submitBtn');
      const originalHTML = btn.innerHTML;
      btn.disabled = true;
      btn.innerHTML = '<span class="animate-pulse">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£...</span>';

      const flexMessage = {
        type: "bubble", size: "mega",
        header: {
          type: "box", layout: "vertical", paddingAll: "20px", backgroundColor: "#4f46e5",
          contents: [
            { type: "text", text: "üìä ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£", weight: "bold", size: "xl", color: "#ffffff" },
            { type: "text", text: dateStr, size: "sm", color: "#ffffffaa", margin: "md" }
          ]
        },
        body: {
          type: "box", layout: "vertical", paddingAll: "25px",
          contents: [
            { type: "box", layout: "horizontal", contents: [
              { type: "text", text: "üì• ‡∏Ç‡πà‡∏≤‡∏ß‡∏£‡∏±‡∏ö", color: "#aaaaaa", flex: 4 },
              { type: "text", text: inNews.toLocaleString() + " ‡∏Ç‡πà‡∏≤‡∏ß", weight: "bold", color: "#3b82f6", align: "end" }
            ]},
            { type: "box", layout: "horizontal", margin: "lg", contents: [
              { type: "text", text: "üì§ ‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡πà‡∏á", color: "#aaaaaa", flex: 4 },
              { type: "text", text: outNews.toLocaleString() + " ‡∏Ç‡πà‡∏≤‡∏ß", weight: "bold", color: "#ef4444", align: "end" }
            ]},
            { type: "separator", margin: "xl" },
            { type: "box", layout: "horizontal", margin: "xl", contents: [
              { type: "text", text: "‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î", weight: "bold", size: "lg" },
              { type: "text", text: total.toLocaleString() + " ‡∏Ç‡πà‡∏≤‡∏ß", weight: "bold", size: "xl", color: "#818cf8", align: "end" }
            ]}
          ]
        },
        footer: {
          type: "box", layout: "vertical",
          contents: [{ type: "text", text: "‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÇ‡∏î‡∏¢: " + reporter, color: "#888888", size: "sm", align: "center" }]
        },
        styles: { footer: { separator: true } }
      };

      try {
        // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡πà‡∏≠‡∏ô
        const saveRes = await fetch(GAS_BACKEND_URL, {
          method: 'POST',
          body: JSON.stringify({ action: 'save', reporter, inNews, outNews, total, dateStr }),
          headers: { 'Content-Type': 'application/json' }
        });
        if (!saveRes.ok) throw new Error('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß');

        // ‡∏™‡πà‡∏á Flex Message
        const result = await liff.shareTargetPicker([{
          type: "flex",
          altText: "‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏¢‡∏≠‡∏î‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£ - " + reporter,
          contents: flexMessage
        }]);

        if (result) {
          Swal.fire({ icon: 'success', title: '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', text: '‡∏™‡πà‡∏á‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', timer: 2000 });
        } else {
          Swal.fire('‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å', '‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢', 'info');
        }
      } catch (err) {
        Swal.fire('‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', err.message, 'error');
      } finally {
        btn.disabled = false;
        btn.innerHTML = originalHTML;
      }
    }

    window.onload = initLiff;
  </script>
</body>
</html>
